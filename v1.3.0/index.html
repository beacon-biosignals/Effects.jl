<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · Effects.jl</title><meta name="title" content="Home · Effects.jl"/><meta property="og:title" content="Home · Effects.jl"/><meta property="twitter:title" content="Home · Effects.jl"/><meta name="description" content="Documentation for Effects.jl."/><meta property="og:description" content="Documentation for Effects.jl."/><meta property="twitter:description" content="Documentation for Effects.jl."/><meta property="og:url" content="https://beacon-biosignals.github.io/Effects.jl/stable/"/><meta property="twitter:url" content="https://beacon-biosignals.github.io/Effects.jl/stable/"/><link rel="canonical" href="https://beacon-biosignals.github.io/Effects.jl/stable/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Effects.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#The-Effect-of-Contrast-Coding"><span>The Effect of Contrast Coding</span></a></li><li><a class="tocitem" href="#Interaction-Terms-in-Effects"><span>Interaction Terms in Effects</span></a></li><li><a class="tocitem" href="#Categorical-Variables-and-Typical-Values"><span>Categorical Variables and Typical Values</span></a></li></ul></li><li><a class="tocitem" href="emmeans/">Estimated Marginal Means</a></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/beacon-biosignals/Effects.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/beacon-biosignals/Effects.jl/blob/main/docs/src/index.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Effects.jl"><a class="docs-heading-anchor" href="#Effects.jl">Effects.jl</a><a id="Effects.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Effects.jl" title="Permalink"></a></h1><p>Regression models are useful but they can be tricky to interpret. Variable centering and contrast coding can obscure the meaning of main effects. Interaction terms, especially higher order ones, only increase the difficulty of interpretation. Here, we introduce Effects.jl which translates the fitted model, including estimated uncertainty, back into data space. Using Effects.jl, it is possible to generate effects plots that enable rapid visualization and interpretation of regression models.</p><p>The examples below demonstrate the use of Effects.jl with GLM.jl, but they will work with any modeling package that is based on the <a href="https://juliastats.org/StatsModels.jl/stable/formula/">StatsModels.jl formula</a>. The second example is borrowed in no small part from <a href="https://beacon-biosignals.github.io/StandardizedPredictors.jl/dev/">StandardizedPredictors.jl</a>.</p><h2 id="The-Effect-of-Contrast-Coding"><a class="docs-heading-anchor" href="#The-Effect-of-Contrast-Coding">The Effect of Contrast Coding</a><a id="The-Effect-of-Contrast-Coding-1"></a><a class="docs-heading-anchor-permalink" href="#The-Effect-of-Contrast-Coding" title="Permalink"></a></h2><p>Let&#39;s consider a synthetic dataset of weights (in grams) for chicks feed different types of feed, with a single predictor <code>feed</code> (categorical, with three levels <code>A</code>, <code>B</code>, <code>C</code>). The simulated weights are based loosely on the R dataset <code>chickwts</code>.</p><pre><code class="language-julia hljs">using AlgebraOfGraphics, CairoMakie, DataFrames, Effects, GLM, StatsModels, StableRNGs
rng = StableRNG(42)
reps = 5
sd = 50
wtdat = DataFrame(; feed=repeat([&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], inner=reps),
                  weight=[180 .+ sd * randn(rng, reps);
                          220 .+ sd * randn(rng, reps);
                          300 .+ sd * randn(rng, reps)])</code></pre><div><div style = "float: left;"><span>15×2 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">feed</th><th style = "text-align: left;">weight</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">A</td><td style = "text-align: right;">146.487</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">A</td><td style = "text-align: right;">202.356</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">A</td><td style = "text-align: right;">248.682</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">A</td><td style = "text-align: right;">245.477</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">A</td><td style = "text-align: right;">186.304</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">B</td><td style = "text-align: right;">254.197</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">B</td><td style = "text-align: right;">169.04</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">B</td><td style = "text-align: right;">180.324</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: left;">B</td><td style = "text-align: right;">308.736</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: left;">B</td><td style = "text-align: right;">284.867</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: left;">C</td><td style = "text-align: right;">217.807</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: left;">C</td><td style = "text-align: right;">339.722</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: left;">C</td><td style = "text-align: right;">234.517</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: left;">C</td><td style = "text-align: right;">298.147</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: left;">C</td><td style = "text-align: right;">353.616</td></tr></tbody></table></div><p>If we fit a linear model to this data using default treatment/dummy coding, then the coefficient corresponding of feed <code>C</code> is significant.</p><pre><code class="language-julia hljs">mod_treat = lm(@formula(weight ~ 1 + feed), wtdat)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">StatsModels.TableRegressionModel{GLM.LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

weight ~ 1 + feed

Coefficients:
───────────────────────────────────────────────────────────────────────
                Coef.  Std. Error     t  Pr(&gt;|t|)  Lower 95%  Upper 95%
───────────────────────────────────────────────────────────────────────
(Intercept)  205.861      25.075   8.21    &lt;1e-05  151.227      260.495
feed: B       33.5719     35.4614  0.95    0.3625  -43.6919     110.836
feed: C       82.9008     35.4614  2.34    0.0375    5.63696    160.165
───────────────────────────────────────────────────────────────────────</code></pre><p>If on the other hand, we use effects (sum-to-zero) coding, then the coefficient for feed <code>C</code> is no longer significant:</p><pre><code class="language-julia hljs">mod_eff = lm(@formula(weight ~ 1 + feed), wtdat; contrasts=Dict(:feed =&gt; EffectsCoding()))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">StatsModels.TableRegressionModel{GLM.LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

weight ~ 1 + feed

Coefficients:
──────────────────────────────────────────────────────────────────────────
                 Coef.  Std. Error      t  Pr(&gt;|t|)   Lower 95%  Upper 95%
──────────────────────────────────────────────────────────────────────────
(Intercept)  244.685       14.4771  16.90    &lt;1e-09  213.143      276.228
feed: B       -5.25232     20.4737  -0.26    0.8019  -49.8606      39.356
feed: C       44.0766      20.4737   2.15    0.0524   -0.531742    88.6849
──────────────────────────────────────────────────────────────────────────</code></pre><p>This is in some sense unsurprising: the different coding schemes correspond to different hypotheses. In treatment coding, the hypothesis for the coefficient <code>feed: C</code> is whether feed <code>C</code> differs from the reference level, feed <code>A</code>. In effects coding, the hypothesis is whether feed <code>C</code> differs from the mean across all levels. In more complicated models, the hypotheses being tested – especially for interaction terms – can become more complex and difficult to &quot;read off&quot; from the model summary.</p><p>In spite of these differences, these models make the same predictions about the data:</p><pre><code class="language-julia hljs">fitted(mod_treat) ≈ fitted(mod_eff)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>At a deep level, these models are the actually same model, but with different parameterizations. In order to get a better view about what a model is saying about the data, abstracted away from the parameterization, we can see what the model looks like in data space. For that, we can use Effects.jl to generate the <em>effects</em> that the model is capturing. We do this by specifying a (subset of the) design and creating a reference grid, then computing the model&#39;s prediction and associated error at those values.</p><p>The <code>effects</code> function will compute the reference grid for a crossed design specified by a dictionary of values. As we only have one predictor in this dataset, the design is completely crossed.</p><pre><code class="language-julia hljs">design = Dict(:feed =&gt; unique(wtdat.feed))
eff_feed = effects(design, mod_eff)</code></pre><div><div style = "float: left;"><span>3×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">feed</th><th style = "text-align: left;">weight</th><th style = "text-align: left;">err</th><th style = "text-align: left;">lower</th><th style = "text-align: left;">upper</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">A</td><td style = "text-align: right;">205.861</td><td style = "text-align: right;">25.075</td><td style = "text-align: right;">180.786</td><td style = "text-align: right;">230.936</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">B</td><td style = "text-align: right;">239.433</td><td style = "text-align: right;">25.075</td><td style = "text-align: right;">214.358</td><td style = "text-align: right;">264.508</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">C</td><td style = "text-align: right;">288.762</td><td style = "text-align: right;">25.075</td><td style = "text-align: right;">263.687</td><td style = "text-align: right;">313.837</td></tr></tbody></table></div><p>The effects table consists of four columns: the levels of the <code>feed</code> predictor specified in the design (<code>feed</code>), the prediction of the model at those levels (<code>weight</code>), the standard error of those predictions <code>err</code>, and the lower and upper edges of confidence interval of those predictions (<code>lower</code>, <code>upper</code>; computed using a normal approximation based on the standard error).</p><p>Because the effects are on the data (response) scale, they are invariant to parameterization:</p><pre><code class="language-julia hljs">effects(design, mod_treat)</code></pre><div><div style = "float: left;"><span>3×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">feed</th><th style = "text-align: left;">weight</th><th style = "text-align: left;">err</th><th style = "text-align: left;">lower</th><th style = "text-align: left;">upper</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">A</td><td style = "text-align: right;">205.861</td><td style = "text-align: right;">25.075</td><td style = "text-align: right;">180.786</td><td style = "text-align: right;">230.936</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">B</td><td style = "text-align: right;">239.433</td><td style = "text-align: right;">25.075</td><td style = "text-align: right;">214.358</td><td style = "text-align: right;">264.508</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">C</td><td style = "text-align: right;">288.762</td><td style = "text-align: right;">25.075</td><td style = "text-align: right;">263.687</td><td style = "text-align: right;">313.837</td></tr></tbody></table></div><p>We can also compute effects on a subset of the levels in the data:</p><pre><code class="language-julia hljs">effects(Dict(:feed =&gt; [&quot;A&quot;]), mod_eff)</code></pre><div><div style = "float: left;"><span>1×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">feed</th><th style = "text-align: left;">weight</th><th style = "text-align: left;">err</th><th style = "text-align: left;">lower</th><th style = "text-align: left;">upper</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">A</td><td style = "text-align: right;">205.861</td><td style = "text-align: right;">25.075</td><td style = "text-align: right;">180.786</td><td style = "text-align: right;">230.936</td></tr></tbody></table></div><p>Note that in this case, we computed the average effect of the level <code>A</code>, which is not directly encoded in any single model coefficient in this parameterization / contrast coding.</p><p>We can of course use the estimated effects to get a nice visual of the data:</p><pre><code class="language-julia hljs">plt = data(eff_feed) * mapping(:feed, :weight) * (visual(Scatter) + mapping(:err) * visual(Errorbars))
draw(plt)</code></pre><img src="index-317310bc.png" alt="Example block output"/><h2 id="Interaction-Terms-in-Effects"><a class="docs-heading-anchor" href="#Interaction-Terms-in-Effects">Interaction Terms in Effects</a><a id="Interaction-Terms-in-Effects-1"></a><a class="docs-heading-anchor-permalink" href="#Interaction-Terms-in-Effects" title="Permalink"></a></h2><p>Let&#39;s consider a (slightly) synthetic dataset of weights for adolescents of different ages, with predictors <code>age</code> (continuous, from 13 to 20) and <code>sex</code>, and <code>weight</code> in pounds.  The weights are based loosely on the medians from the <a href="https://www.cdc.gov/growthcharts/html_charts/wtage.htm">CDC growth charts</a>, which show that the median male and female both start off around 100 pounds at age 13, but by age 20 the median male weighs around 155 pounds while the median female weighs around 125 pounds.</p><pre><code class="language-julia hljs">using AlgebraOfGraphics, CairoMakie, DataFrames, Effects, GLM, StatsModels, StableRNGs
rng = StableRNG(42)
growthdata = DataFrame(; age=[13:20; 13:20],
                       sex=repeat([&quot;male&quot;, &quot;female&quot;], inner=8),
                       weight=[range(100, 155; length=8); range(100, 125; length=8)] .+ randn(rng, 16))</code></pre><div><div style = "float: left;"><span>16×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">age</th><th style = "text-align: left;">sex</th><th style = "text-align: left;">weight</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">13</td><td style = "text-align: left;">male</td><td style = "text-align: right;">99.3297</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">14</td><td style = "text-align: left;">male</td><td style = "text-align: right;">108.304</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">15</td><td style = "text-align: left;">male</td><td style = "text-align: right;">117.088</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">16</td><td style = "text-align: left;">male</td><td style = "text-align: right;">124.881</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">17</td><td style = "text-align: left;">male</td><td style = "text-align: right;">131.555</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">18</td><td style = "text-align: left;">male</td><td style = "text-align: right;">139.97</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">19</td><td style = "text-align: left;">male</td><td style = "text-align: right;">146.124</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">20</td><td style = "text-align: left;">male</td><td style = "text-align: right;">154.206</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">13</td><td style = "text-align: left;">female</td><td style = "text-align: right;">101.775</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">14</td><td style = "text-align: left;">female</td><td style = "text-align: right;">104.869</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: right;">15</td><td style = "text-align: left;">female</td><td style = "text-align: right;">105.499</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: right;">16</td><td style = "text-align: left;">female</td><td style = "text-align: right;">111.509</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: right;">17</td><td style = "text-align: left;">female</td><td style = "text-align: right;">112.976</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: right;">18</td><td style = "text-align: left;">female</td><td style = "text-align: right;">117.82</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: right;">19</td><td style = "text-align: left;">female</td><td style = "text-align: right;">122.501</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: right;">20</td><td style = "text-align: left;">female</td><td style = "text-align: right;">124.603</td></tr></tbody></table></div><p>In this dataset, there&#39;s obviously a main effect of sex: males are heavier than females for every age except 13 years.  But if we run a basic linear regression, we see something rather different:</p><pre><code class="language-julia hljs">mod_uncentered = lm(@formula(weight ~ 1 + sex * age), growthdata)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">StatsModels.TableRegressionModel{GLM.LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

weight ~ 1 + sex + age + sex &amp; age

Coefficients:
──────────────────────────────────────────────────────────────────────────────
                     Coef.  Std. Error       t  Pr(&gt;|t|)  Lower 95%  Upper 95%
──────────────────────────────────────────────────────────────────────────────
(Intercept)       56.4387     2.88762    19.55    &lt;1e-09   50.1471    62.7303
sex: male        -56.1509     4.08372   -13.75    &lt;1e-07  -65.0485   -47.2532
age                3.40941    0.173344   19.67    &lt;1e-09    3.03172    3.78709
sex: male &amp; age    4.31146    0.245146   17.59    &lt;1e-09    3.77734    4.84559
──────────────────────────────────────────────────────────────────────────────</code></pre><p>Is this model just a poor fit to the data? We can plot the effects and see that&#39;s not the case. For example purposes, we&#39;ll create a reference grid that does not correspond to a fully balanced design and call <code>effects!</code> to insert the effects-related columns. In particular, we&#39;ll take odd ages for males and even ages for females.</p><pre><code class="language-julia hljs">refgrid = copy(growthdata)
filter!(refgrid) do row
    return mod(row.age, 2) == (row.sex == &quot;male&quot;)
end
effects!(refgrid, mod_uncentered)</code></pre><div><div style = "float: left;"><span>8×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">age</th><th style = "text-align: left;">sex</th><th style = "text-align: left;">weight</th><th style = "text-align: left;">err</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">13</td><td style = "text-align: left;">male</td><td style = "text-align: right;">100.659</td><td style = "text-align: right;">0.72515</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">15</td><td style = "text-align: left;">male</td><td style = "text-align: right;">116.101</td><td style = "text-align: right;">0.474722</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">17</td><td style = "text-align: left;">male</td><td style = "text-align: right;">131.543</td><td style = "text-align: right;">0.406528</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">19</td><td style = "text-align: left;">male</td><td style = "text-align: right;">146.984</td><td style = "text-align: right;">0.587838</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">14</td><td style = "text-align: left;">female</td><td style = "text-align: right;">104.17</td><td style = "text-align: right;">0.587838</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">16</td><td style = "text-align: left;">female</td><td style = "text-align: right;">110.989</td><td style = "text-align: right;">0.406528</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">18</td><td style = "text-align: left;">female</td><td style = "text-align: right;">117.808</td><td style = "text-align: right;">0.474722</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">20</td><td style = "text-align: left;">female</td><td style = "text-align: right;">124.627</td><td style = "text-align: right;">0.72515</td></tr></tbody></table></div><p>Note that the column corresponding to the response variable <code>weight</code> has been overwritten with the effects prediction and that only the standard error is provided: the <a href="api/#Effects.effects!-Tuple{DataFrames.DataFrame, StatsAPI.RegressionModel}"><code>effects!</code></a> method does less work than the <a href="api/#Effects.effects-Tuple{AbstractDict, StatsAPI.RegressionModel}"><code>effects</code></a> convenience method.</p><p>We can add the confidence interval bounds in and plot our predictions:</p><pre><code class="language-julia hljs">refgrid[!, :lower] = @. refgrid.weight - 1.96 * refgrid.err
refgrid[!, :upper] = @. refgrid.weight + 1.96 * refgrid.err
sort!(refgrid, [:age])

plt = data(refgrid) * mapping(:age, :weight; color=:sex) *
      (visual(Lines) + mapping(; lower=:lower, upper=:upper) * visual(LinesFill))
draw(plt)</code></pre><img src="index-9684dd10.png" alt="Example block output"/><p>We can also add in the raw data to check the model fit:</p><pre><code class="language-julia hljs">draw(plt + data(growthdata) * mapping(:age, :weight; color=:sex) * visual(Scatter))</code></pre><img src="index-f7015081.png" alt="Example block output"/><p>The model seems to be doing a good job. Indeed it is, and as pointed out in the <a href="https://beacon-biosignals.github.io/StandardizedPredictors.jl/dev/">StandardizedPredictors.jl</a> docs, the problem is that we should center the <code>age</code> variable. While we&#39;re at it, we&#39;ll also set the contrasts for <code>sex</code> to be effects coded.</p><pre><code class="language-julia hljs">using StandardizedPredictors
contrasts = Dict(:age =&gt; Center(15), :sex =&gt; EffectsCoding())
mod_centered = lm(@formula(weight ~ 1 + sex * age), growthdata; contrasts=contrasts)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">StatsModels.TableRegressionModel{GLM.LinearModel{GLM.LmResp{Vector{Float64}}, GLM.DensePredChol{Float64, LinearAlgebra.CholeskyPivoted{Float64, Matrix{Float64}, Vector{Int64}}}}, Matrix{Float64}}

weight ~ 1 + sex + age(centered: 15) + sex &amp; age(centered: 15)

Coefficients:
────────────────────────────────────────────────────────────────────────────────────────────
                                   Coef.  Std. Error       t  Pr(&gt;|t|)  Lower 95%  Upper 95%
────────────────────────────────────────────────────────────────────────────────────────────
(Intercept)                    111.84       0.335679  333.18    &lt;1e-24  111.109    112.572
sex: male                        4.26052    0.335679   12.69    &lt;1e-07    3.52914    4.99191
age(centered: 15)                5.56514    0.122573   45.40    &lt;1e-14    5.29808    5.8322
sex: male &amp; age(centered: 15)    2.15573    0.122573   17.59    &lt;1e-09    1.88867    2.42279
────────────────────────────────────────────────────────────────────────────────────────────</code></pre><p>All of the estimates have now changed because the parameterization is completely different, but the predictions and thus the effects remain unchanged:</p><pre><code class="language-julia hljs">refgrid_centered = copy(growthdata)
effects!(refgrid_centered, mod_centered)
refgrid_centered[!, :lower] = @. refgrid_centered.weight - 1.96 * refgrid_centered.err
refgrid_centered[!, :upper] = @. refgrid_centered.weight + 1.96 * refgrid_centered.err
sort!(refgrid_centered, [:age])

plt = data(refgrid_centered) * mapping(:age, :weight; color=:sex) *
      (visual(Lines) + mapping(; lower=:lower, upper=:upper) * visual(LinesFill))
draw(plt)</code></pre><img src="index-c42d2e47.png" alt="Example block output"/><p>Understanding lower-level terms in the presence of interactions can be particularly tricky, and effect plots are also useful for this. For example, if we want to examine the effect of <code>sex</code> at a <em>typical</em> <code>age</code>, then we would need some way to reduce <code>age</code> to <code>typical</code> values. By default, <code>effects[!]</code> will take use the mean of all model terms not specified in the effects formula as representative values. Looking at <code>sex</code>, we see that</p><pre><code class="language-julia hljs">design = Dict(:sex =&gt; unique(growthdata.sex))
effects(design, mod_uncentered)</code></pre><div><div style = "float: left;"><span>2×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">sex</th><th style = "text-align: left;">weight</th><th style = "text-align: left;">err</th><th style = "text-align: left;">lower</th><th style = "text-align: left;">upper</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">male</td><td style = "text-align: right;">127.682</td><td style = "text-align: right;">0.397181</td><td style = "text-align: right;">127.285</td><td style = "text-align: right;">128.079</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">female</td><td style = "text-align: right;">112.694</td><td style = "text-align: right;">0.397181</td><td style = "text-align: right;">112.297</td><td style = "text-align: right;">113.091</td></tr></tbody></table></div><p>correspond to the model&#39;s estimate of weights for each sex at the average age in the dataset. Like all effects predictions, this is invariant to contrast coding:</p><pre><code class="language-julia hljs">effects(design, mod_centered)</code></pre><div><div style = "float: left;"><span>2×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">sex</th><th style = "text-align: left;">weight</th><th style = "text-align: left;">err</th><th style = "text-align: left;">lower</th><th style = "text-align: left;">upper</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">male</td><td style = "text-align: right;">127.682</td><td style = "text-align: right;">0.397181</td><td style = "text-align: right;">127.285</td><td style = "text-align: right;">128.079</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">female</td><td style = "text-align: right;">112.694</td><td style = "text-align: right;">0.397181</td><td style = "text-align: right;">112.297</td><td style = "text-align: right;">113.091</td></tr></tbody></table></div><h2 id="Categorical-Variables-and-Typical-Values"><a class="docs-heading-anchor" href="#Categorical-Variables-and-Typical-Values">Categorical Variables and Typical Values</a><a id="Categorical-Variables-and-Typical-Values-1"></a><a class="docs-heading-anchor-permalink" href="#Categorical-Variables-and-Typical-Values" title="Permalink"></a></h2><p>We can also compute effects for the different ages at typical values of <code>sex</code> for this dataset. For categorical variables, the typical values are computed on the contrasts themselves. For balanced datasets and the default use of the mean as typical values, this reflects the average across all levels of the categorical variable.</p><p>For our model using the centered parameterization and effects coding, the effect at the center (<code>age = 15</code>) at typical values of <code>sex</code> is simply the intercept: the mean weight across both sexes at age 15.</p><pre><code class="language-julia hljs">effects(Dict(:age =&gt; [15]), mod_centered)</code></pre><div><div style = "float: left;"><span>1×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">age</th><th style = "text-align: left;">weight</th><th style = "text-align: left;">err</th><th style = "text-align: left;">lower</th><th style = "text-align: left;">upper</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">15</td><td style = "text-align: right;">111.84</td><td style = "text-align: right;">0.335679</td><td style = "text-align: right;">111.505</td><td style = "text-align: right;">112.176</td></tr></tbody></table></div><p>If we had an imbalanced dataset, then averaging across all values of the contrasts would be weighted towards the levels (here: sex) with more observations. This makes sense: the category with more observations is in some sense more &quot;typical&quot; for that dataset.</p><pre><code class="language-julia hljs"># create imbalance
growthdata2 = growthdata[5:end, :]
mod_imbalance = lm(@formula(weight ~ 1 + sex * age), growthdata2; contrasts=contrasts)
effects(Dict(:age =&gt; [15]), mod_imbalance)</code></pre><div><div style = "float: left;"><span>1×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">age</th><th style = "text-align: left;">weight</th><th style = "text-align: left;">err</th><th style = "text-align: left;">lower</th><th style = "text-align: left;">upper</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">15</td><td style = "text-align: right;">110.728</td><td style = "text-align: right;">0.712056</td><td style = "text-align: right;">110.016</td><td style = "text-align: right;">111.44</td></tr></tbody></table></div><p>Finally, we note that the user can specify alternative functions for computing the typical values. For example, specifying the <code>mode</code> for the imbalanced dataset results in effects estimates for the most frequent level of <code>sex</code>, i.e. <code>female</code>:</p><pre><code class="language-julia hljs">using StatsBase
effects(Dict(:age =&gt; [15]), mod_imbalance; typical=mode)</code></pre><div><div style = "float: left;"><span>1×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">age</th><th style = "text-align: left;">weight</th><th style = "text-align: left;">err</th><th style = "text-align: left;">lower</th><th style = "text-align: left;">upper</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">15</td><td style = "text-align: right;">107.58</td><td style = "text-align: right;">0.48853</td><td style = "text-align: right;">107.091</td><td style = "text-align: right;">108.068</td></tr></tbody></table></div><p>Note that these should be scalar valued functions, so we can use <code>minimum</code> or <code>maximum</code> but not <code>extrema</code>:</p><pre><code class="language-julia hljs">effects(Dict(:sex =&gt; [&quot;female&quot;, &quot;male&quot;]), mod_imbalance; typical=maximum)</code></pre><div><div style = "float: left;"><span>2×5 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">sex</th><th style = "text-align: left;">weight</th><th style = "text-align: left;">err</th><th style = "text-align: left;">lower</th><th style = "text-align: left;">upper</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">female</td><td style = "text-align: right;">124.627</td><td style = "text-align: right;">0.746242</td><td style = "text-align: right;">123.881</td><td style = "text-align: right;">125.373</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">male</td><td style = "text-align: right;">154.08</td><td style = "text-align: right;">0.96724</td><td style = "text-align: right;">153.113</td><td style = "text-align: right;">155.047</td></tr></tbody></table></div><pre><code class="language-julia hljs">using Test
@test_throws ArgumentError effects(Dict(:sex =&gt; [&quot;female&quot;, &quot;male&quot;]), mod_imbalance; typical=extrema)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr32"><span class="sgr1">Test Passed</span></span>
      Thrown: ArgumentError</code></pre></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="emmeans/">Estimated Marginal Means »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Tuesday 9 July 2024 20:51">Tuesday 9 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
